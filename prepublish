#!/bin/bash

# rm -rvf world

# alternative shape files with admin_0_sovereignty states separated out
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_sovereignty.zip

world_shp() {
  mkdir -p build
  curl -z build/ne_$1_admin_0_countries.zip -o build/ne_$1_admin_0_countries.zip http://naciscdn.org/naturalearth/$1/cultural/ne_$1_admin_0_countries.zip
  unzip -od build build/ne_$1_admin_0_countries.zip
  chmod a-x build/ne_$1_admin_0_countries.*
}

world_sov_shp() {
  mkdir -p build
  curl -o build/ne_$1_admin_0_sovereignty.zip http://www.naturalearthdata.com/download/$1/cultural/ne_$1_admin_0_sovereignty.zip
  unzip -od build build/ne_$1_admin_0_sovereignty.zip
  chmod a-x build/ne_$1_admin_0_sovereignty.*
}

world_sov() {
  # world_sov_shp $1
  mkdir -p world

  geo2topo -q 1e5 -n countries=<( \
      shp2json -n build/ne_$1_admin_0_map_units.shp \
        | ndjson-map 'd.id = d.properties.iso_n3, d' \
        | geostitch -n) \
    | topomerge land=countries \
    > world/$1.json
}

world_sov 10m
